---
title: 操作系统 —— VOL.4 线程
tags: "操作系统"
key: os-4
sidebar:
  nav: os
---

本系列是操作系统学习的记录笔记，参考了书籍《操作系统概念》。文章主要介绍线程的相关内容。<!--more-->


# 概述

- 每个线程是CPU使用的一个基本单元
- 一个线程包括线程ID、程序计数器、寄存器组和堆栈，它与同一进程的其他线程共享代码段、数据段和其他操作系统资源
- 一个进程一般具有多个线程，这样的进程能同时执行多个任务
- 操作系统创建多个进程比在一个进程中创建多个线程的开销要大
- 进程间通信比线程间通信更加复杂
- 优点：
  - 响应性高：如果一个交互程序采用多线程，即使部分阻塞或执行冗余操作，它仍可以继续执行，从而增加了对用户的响应程度
  - 资源共享：进程只能通过共享内存等技术实现资源共享，而线程默认共享它们所属进程的内存和资源
  - 经济性：进程创建所需的内存和资源分配非常昂贵
  - 可伸缩性：对于多处理器体系结构，多线程的优点更大，因为多线程可在多处理器核上并行运行

# 多处理器编程

- 并发性：指通过CPU上下文切换，在同一时间段内执行多个任务的情况
- 并行性：指多核系统，在同一时刻执行多个任务的情况

# 多线程模型

首先声明两类线程：用户线程：位于内核之上，其管理无需内核支持。内核线程：由操作系统来支持与管理。

常见的多线程模型有：

- 多对一模型
  - 映射多个用户级线程到一个内核线程，线程管理是由用户空间的线程库完成，因此效率更高；
  - 如果一个线程执行阻塞系统调用，那么整个进程将会被阻塞；
  - 任一时间只有一个线程可以访问内核，多个线程不能并行运行在多处理核系统上；
  - 现代操作系统基本不使用该模型，因为它无法利用多个处理核。
![](/assets/posts/os-4-1.jpg)

- 一对一模型
  - 映射每个用户线程到一个内核线程；
  - 该模型在一个线程执行阻塞系统调用时，能够允许另一个线程继续执行，所以提供了比多对一模型更好的并发功能；
  - 允许多个线程并行运行在多处理器系统上；
  - 缺点是创建一个用户线程就需要创建一个对应的内核线程，但创建内核线程的开销会影响应用程序的性能。
![](/assets/posts/os-4-2.jpg)

- 多对多模型
  - 多路复用多个用户线程到同样数量或更少数量的内核线程；
  - 可以创建任意多的用户线程，且相应内核线程在多处理器系统上并发执行；
  - 当一个线程执行阻塞系统调用时，内核可以调用另一个线程来执行。
![](/assets/posts/os-4-3.jpg)

- 双层模型
  - 多对多模型的变种，仍采用多路复用机制；
  - 允许绑定某个用户线程到一个内核线程。
![](/assets/posts/os-4-4.jpg)

- 线程池
  - 在进程开始时创建一定数量的线程并加到池中等待工作。
  - 优点：
    - 用现有线程服务请求比等待创建一个线程更快；
    - 线程池限制了创建的线程数量；
    - 将执行任务从创建任务的机制中分离出来 。