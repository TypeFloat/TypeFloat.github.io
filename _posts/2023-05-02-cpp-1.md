---
title: C++学习 —— VOL.1 C++程序是如何工作的
tags: C++
key: C++-1
---

这是一篇C++的教程，也是我自己的学习笔记，本节主要介绍了C++代码是如何从编写到执行的。<!--more-->

# 写在前面

这只是C++的一份基础教程，因此并不需要非常复杂的开发环境，对于本节的知识，只需要一个文本编辑器和一个C++编译器即可，如果你还没有配置好这些，你可以在[这里](https://github.com/TypeFloat/Learning-CPP)找到该教程使用的docker环境以及笔记中的所有代码。如果你并不了解docker，你可以在[这里](https://blog.typefloat.cn/2023/05/02/env-docker.html)找到docker的安装与使用教程，它可以快速的帮你搭建起本课程所需要的所有开发环境。

这篇笔记是根据国外的大佬录制的教学视频进行整理的，[视频戳这儿](https://www.youtube.com/watch?v=18c3MTX0PK0&list=PLlrATfBNZ98dudnM48yfGUldqGD0S4FFb)，B站也有中文的搬运，[视频戳这儿](https://www.bilibili.com/video/BV1N24y1B7nQ?p=2&vd_source=0307132b97183cff4ff2138cf704f827)。

# 第一个C++程序

所有的编程语言的学习都是从一段helloworld开始的，C++也不例外，我们先来看一下C++的helloworld是什么样的。请不要忽略任何一行注释，它们都是非常重要的。

```cpp
// [1]
#include <iostream>

// [2]
int main(int argc, char **argv)
{
    // [3]
    std::cout << "Hello World!" << std::endl;
    // [4]
    return 0;
}
```

这就是一个最简单的C++程序，它的作用是在屏幕中输出`Hello World!`，我们来逐行分析一下这个程序。
- [1]：以'#'开始的代码表示预处理命令，在编译之前进行预处理，最常见的预处理命令就是include，该命令将会将指向文件中的内容拷贝到当前位置。在这里，我们使用了`#include <iostream>`，它的作用是将iostream文件中的内容拷贝到当前位置，iostream文件中包含了C++的输入输出流，我们可以通过它来进行输入输出操作。
- [2]：这是一个函数，它的返回值是int类型，函数名为main，它有两个参数，分别是int类型的argc和char类型的argv，这两个参数是用来接收命令行参数的，我们暂时不需要关心它们。这个函数是C++程序的入口，也就是说，当我们执行一个C++程序时，程序会从这个函数开始执行。
- [3]：这是一个输出语句，它的作用是将`Hello World!`输出到屏幕上，`<<`是一个重载运算符，重载运算法等同于函数。`cout`和`endl`都是`iostream`中的对象，`cout`表示标准输出流，`endl`表示换行符。`std`是一个命名空间，它并不是本节的重点，因此我们暂时不需要关心它。
- [4]：这是一个返回语句，它的作用是将0返回给操作系统，这个0表示程序正常退出，如果程序出现了异常，我们可以返回一个非0的值，这个值可以用来表示程序出现了什么异常。

# 如何运行

我们已经写好了第一个C++程序，接下来我们需要将它编译并运行起来，我们可以使用g++来编译这个程序，g++是一个C++编译器，它可以将C++代码编译成可执行文件，我们可以通过以下命令来编译这个程序。在执行所有命令之前，请确保你在一个正确的路径下，以便编译器能够找到我们的代码文件。

```bash
g++ helloworld.cpp -o helloworld 
```

其中，`helloworld.cpp`表示输入的文件名，`-o`表示输出，`helloworld`表示输出的文件名，，我们可以通过以下命令来运行这个程序。

```bash
./helloworld
```

你将会在屏幕中看到`Hello World!`，这就是我们的第一个C++程序。但本节还会更深入的讲解C++程序是如何工作的，因此，我们还需要了解一些更多的知识。

一份C++代码从编写完成到执行，需要经过以下几个步骤：
1. 预处理
2. 编译
3. 汇编
4. 链接
5. 执行

## 预处理

预处理在编写代码的时候我们已经看到了，主要处理相关的预处理命令，我们可以通过以下命令来查看预处理之后的代码。

```bash
g++ -E helloworld.cpp -o helloworld.i
```

其中，`-E`表示只进行预处理，`helloworld.i`表示输出的文件名，我们可以通过以下命令来查看预处理之后的代码。

```bash
cat helloworld.i
```

## 编译

预处理之后的代码文件仍是C++文件，但不包含任何预处理命令了，这时需要对文件进行编译，将高级语言转变为汇编语言，可以通过以下命令来进行编译。

```bash
g++ -S helloworld.i -o helloworld.s
```

其中，`-S`表示只进行编译，`helloworld.s`表示输出的文件名，我们可以通过以下命令来查看编译之后的代码。

```bash
cat helloworld.s
```

## 汇编

汇编是将汇编代码转换成机器码，可以通过以下命令来进行汇编。

```bash
g++ -c helloworld.s -o helloworld.o
```

其中，`-c`表示只进行汇编，`helloworld.o`表示输出的文件名，这个文件是一个二进制的文件，我们无法直接查看它的内容。

## 链接

链接是将多个二进制文件链接成一个可执行文件，可以通过以下命令来进行链接。

```bash
g++ helloworld.o -o helloworld
```

## 执行

链接后的文件不具有任何文件后缀，这表示一个可执行文件，在windows系统中是`exe`。我们可以通过以下命令来执行这个文件。

```bash
./helloworld
```