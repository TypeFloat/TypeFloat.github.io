---
title: 操作系统 —— VOL.1 概论
tags: "Operating System"
key: os-8
sidebar:
  nav: os
---

本系列是操作系统学习的记录笔记，参考了书籍《操作系统概念》。文章主要介绍操作系统知识的概览。<!--more-->

# 计算机组成原理概述

## 计算机系统的结构

![](/assets/posts/os-1-1.jpg)

- 硬件：提供最基本的计算资源，例如：CPU、内存、I/O设备
- 操作系统：控制和协调不同的应用和用户使用硬件
- 应用程序：定义了用户解决计算问题使用的系统资源的方式，例如：文字处理程序、编译器、浏览器、数据库系统、游戏等
- 用户：人、机器、其他计算机

## 计算机系统的体系结构

- 单处理器系统
  - 单处理器系统只有一个主CPU，以便执行一个通用指令集
  - 几乎所有单处理器系统都有其他专用处理器，如特定设备的控制器、I/O处理器等
  - 其操作系统主要负责资源管理和人机交互
- 多处理器系统
  - 并发：两个或多个进程几乎同时的在处理器上执行，单处理器系统可以通过分时技术实现并发
  - 并行：多个程序同时在多个处理器上运行
  - 紧耦合系统：处理器共享内存、总线和时钟，通过共享内存实现通信
  - 优点：
    - 提高吞吐量，加速计算
    - 规模经济，可以共享外设、大容量存储、电源供给等
    - 增加可靠性，容错率更高
  - 非对称多处理
    - 每个处理器有各自特定的任务
    - 主从关系，主处理器调度从处理器并安排工作
    - 多用于超大系统
  - 对称多处理
    - 每个处理器都参与完成操作系统的所有任务
    - 许多进程可以同时执行且不会明显影响性能
  - 多核
    - 集成多个计算核到单个芯片
    - 每一个计算核心都等同于一个标准处理器
  - 并行系统中操作系统的特点：
    - 允许进程和资源在多个处理器之间动态共享
    - 负责不同处理器上进程之间的通信和协调
- 集群系统
  - 松耦合的，每个节点可作为独立的单处理器系统或多处理器系统
  - 定义：多台计算机通过局域网（LAN）连接在一起，以提供高可用性的高性能计算（HPC）
  - 一种流行的分布式系统
  - 集群系统中操作系统的特点：
    - 是一种分布式操作系统
    - 分布式文件系统，为磁盘上的数据提供访问控制
    - 存储域网（SAN），允许将多台主机连接到多个存储单元。

## 计算机系统的组成

![](/assets/posts/os-1-2.jpg)

- 一个或多个CPU、设备控制器，两者通过总线连接并接入共享内存
- CPU与设备控制器可以并发执行，竞争访问内存，需要内存控制器来协调访问内存

## 存储结构

![](/assets/posts/os-1-3.jpg)

- 内存：只有CPU可以直接访问的大容量存储介质
  - 随机访问内存
  - 断电丢失
- 对于冯诺伊曼体系结构的计算机，在一个典型的指令执行周期中：
  - 从内存中获取指令并存到指令寄存器
  - 将指令编码
  - 可能会从内存中获取操作数据并且存到内部寄存器
  - 结果可能存到内存中
- 理想情况中，程序和数据应该永久驻留在内存中，但实际中不可能：
  - 内存通常很小
  - 内存是易失的
- 外存，提供大量非易失性存储容量的内存的扩展：
  - 磁盘：磁盘表面在逻辑上分为轨道，轨道细分为扇区，磁盘控制器决定设备和计算机之间的逻辑交互
  - 固态硬盘：非易失的，速度比磁盘块
- 外部存储：
  - 非易失、速度慢、容量大
  - 例如磁带、光盘

## I/O结构

![](/assets/posts/os-1-4.jpg)

- 设备驱动程序在I/O操作中起着重要作用
- I/O中断驱动（移动少量数据）
  - 设备驱动程序加载设备控制器的适当寄存器
  - 设备控制器检查寄存器并采取相应操作
  - 控制器从设备向本地缓冲区传输数据
  - 数据传输完毕后，设备控制器通过中断通知设备驱动程序已完成操作
  - 设备驱动程序将控制权转回操作系统
    - 对于读操作，数据或数据指针也会返回
    - 对于其他操作，设备驱动程序会返回状态信息
- 直接内存访问
  - 设备控制器可在本地缓冲和内存之间传送整块的数据而无需CPU的干预
  - 每个块只生成一个中断，而不是每个字节生成一个中断

## 计算机系统的执行

- 引导计算机启动，当启动或重启时会加载引导程序：
  - 引导程序通常被存储在固件中，如ROM(只读内存)或EPROM(可擦可编程只读内存)
  - 引导程序将初始化系统的各个组件，如CPU寄存器、设备控制器、内存
  - 引导程序将定位操作系统内核并加载到内核中，当内核加载并执行后，成为系统进程或系统后台程序，等待处理其他事情
- 使用中断来通知事件的发生：
  - 硬件可以随时通过系统总线发送信号到CPU以触发中断
  - 软件可以执行系统调用来触发中断，如由错误或用户请求引起的陷阱和异常
- 当CPU被中断时，它将停止正在做的事，并立即转到固定位置再继续执行，该固定位置通常包含中断服务程序的开始地址
- 当中断处理结束后，CPU将会恢复被中断的计算
- 中断处理：
  - 只有少量的中断类型被提前定义，以提高处理中断的速度
  - 中断处理程序的指针表(中断向量)存储在内存中
  - 计算机体系结构必须保存被中断指令的地址
  - 操作系统将会通过保存寄存器值和程序计数器来记录CPU状态
  - 判断发生了何种中断
  - 根据发生的中断类型决定执行某个中断处理程序

# 操作系统概述

## 操作系统的功能

- 定义：

  - 操作系统是一直运行在计算机上的程序

  - 位于计算机用户与计算机硬件之前的一个计算机程序

  - 通常称为内核

    注：除内核之外还有两种程序：系统程序、应用程序

- 目标：

  - 执行用户程序
  - 让计算机系统变得易用
  - 更有效的使用计算机硬件

- 用户层次

  - 个人计算机：使计算机易用且有高性能，忽略资源利用问题
  - 分享式计算机（大型机、小型机）：最大化资源利用
  - 专用计算机（工作站）：既有专用资源也有共享资源，要兼顾使用方便性和资源利用率
  - 手持计算机：个人使用、管理能耗
  - 嵌入式计算机：无需人为干预

- 系统层次

  - 操作系统是一个资源分配器，管理所有资源
  - 操作系统是一个控制程序，控制着程序的执行

## 操作系统的结构

- 多道程序设计（批处理系统）
  - 单个程序不能让CPU和I/O设备始终忙碌
  - 多道程序设计通过安排作业（编码与数据）使得CPU总在执行一个作业，提高CPU利用率
  - 系统中的一部分作业会被保留在内存中
  - 通过调度选择和执行作业
  - 当作业需要等待其他任务，如I/O操作时，CPU会切换到其他作业
- 分时系统（多任务）
  - 多道程序设计的延伸
  - CPU时间被分为时间片，每个作业一次占用一个时间片
  - 响应时间要短
  - 每个用户至少有一个程序在内存中，即进程
  - 作业最开始保存在磁盘上的作业池中，通过作业调度加载至内存
  - 当多个任务保存在进程中时，需要内存管理
  - 多个任务处于就绪态时，需要CPU调度
  - 进程可通过交换技术从磁盘调入内存或从内存调入磁盘
  - 虚拟内存技术允许执行不完全在内存中的进程
  - 文件系统
  - 磁盘管理
  - 资源保护
  - 作业同步
  - 死锁预防

## 操作系统的执行

- 中断驱动
  - 硬件设备可以产生中断
  - 软件中断（异常或陷阱）
    - 软件错误，如除数为零或无效存储访问
    - 用户程序的特定请求，如执行操作系统服务
    - 其他流程问题包括无限循环、相互修改的进程
- 双重模式执行
  - 目标：允许操作系统保护自己和其他系统组件
  - 原则：识别可能造成伤害的机器指令，并将这些指令指定为特权指令
  - 分为用户模式和内核模式，特权指令只能在内核态下运行
  - 计算机硬件通过模式位来表示当前模式
    - 0表示内核模式，1表示用户模式
    - 提供区分操作系统执行的任务与用户执行的任务的能力
    - CPU渐渐支持多模式，如虚拟机管理器模式
  - 在系统启动时，CPU以内核模式启动。在操作系统加载到内存中并开始在正常状态下工作后，CPU切换到用户模式以运行用户程序
  - 当用户应用程序通过系统调用从操作系统请求服务时，将生成陷阱并通过中断向量传递给操作系统服务程序
  - CPU在内核模式下运行系统服务程序
  - 在将控制权传递给用户程序之前，操作系统切换到用户模式

![](/assets/posts/os-1-5.jpg)

- 定时器控制，防止用户程序陷入死循环或长时间占用资源
  - 定时器在指定周期后中断计算机
  - 通过递减的计数器来指定周期，当计数器为0时，产生中断，控制权自动转回操作系统
  - 在将控制交给用户之前，由操作系统设定好计数器的值

## 进程管理

- 程序是被动实体，进程是主动实体，进程是正在执行的程序，它是系统内的一个工作单位
- 进程需要一定的资源来完成任务
- 当进程中止时，操作系统会回收所有可再利用的资源
- 单线程进程有一个程序计数器指定下一个要执行的指令，进程一条一条的执行指令，直至完成
- 多线程进程每个线程都有一个程序计数器，但同一时间每个进程最多只能执行一条指令
- 系统由多个进程组成，所有进程将会并发执行
- 操作系统负责进程管理的以下活动：
  - 在CPU上调度进程和线程
  - 创建和删除用户进程和系统进程
  - 挂起和重启进程
  - 提供进程同步机制
  - 提供进程通信机制
  - 提供自锁处理机制

## 内存管理

- 要执行的程序其指令必须全部或部分位于内存中
- 程序所需要的数据必须全部或部分位于内存中
- 内存管理决定哪些指令或资源位于内存中，以优化CPU利用率和用户响应时间
- 操作系统负责内存管理的以下活动：
  - 记录内存的哪部分在被使用及被谁使用
  - 决定哪些进程或其部分会调入或调出内存
  - 根据需要分配和释放内存空间

## 存储管理

- 操作系统提供信息存储的统一逻辑试图：
  - 对存储设备的物理属性进行抽象并定义逻辑存储单元，即文件
  - 每个存储介质都有一个设备来控制，它们有不同的特点，例如访问速度、容量、数据传输速率、访问方法等
- 文件系统管理
  - 文件通常被组织为目录
  - 进行访问控制，谁可以访问哪些
  - 操作系统负责文件管理的以下活动：
    - 创建和删除文件、目录
    - 提供文件和目录的操作原语
    - 映射文件到外存
    - 备份文件到稳定非易失的存储介质
- 大容量存储器管理
  - 通常用于存储不适合内存的数据或必须“长时间”保存的数据
  - 计算机运行的最终速度与硬盘子系统的速度与管理该子系统的算法有很大关系
  - 操作系统负责硬盘管理的以下活动：
    - 空闲空间管理
    - 存储空间分配
    - 硬盘调度
  - 其他速度更慢的存储设备
    - 第三方存储设备，如光盘、磁带
    - 仍然必须由操作系统或应用程序管理
    - 分为一次写多次读和读-写两类
- 高速缓存
  - 是计算机系统的一条重要设计准则
  - 使用中的信息暂时从较慢的存储复制到更快的存储，即高速缓存
  - 当需要特定信息时，会首先检查是否处于高速缓存中：
    - 若存在，可以直接使用高速缓存的信息
    - 若不存在，则只用位于源地的信息，同时复制到高速缓存中
  - 高速缓存小于需要存储的缓存，因此高速缓存管理的设计非常重要，需要谨慎选择高速缓存的大小与置换策略
  - 多处理器环境必须在硬件中保证高速缓存一致性，以便所有CPU在其缓存中具有最新值，对于分布式系统，该问题将会更加复杂

![](/assets/posts/os-1-6.jpg)

- I/O子系统
  - 操作系统的目的之一是为用户隐藏具体硬件设备的特性
  - I/O子系统主要负责：
    - I/O的内存管理，包括缓冲（传输时临时存储数据）、缓存（将部分数据存储在更快的存储中以获得性能）、线轴（协调并发输出）
    - 设备驱动器的通用接口
    - 特定硬件设备的驱动程序

## 保护与安全

- 保护：控制进程或用户访问操作系统定义的资源的一种机制
- 安全：保护系统免受内部和外部攻击，包括拒绝服务、蠕虫、病毒、身份偷窃、服务偷窃等
- 系统通常首先区分用户，以确定谁可以做什么
  - 用户标识（用户ID、安全ID）包括名称和相关号码，每个用户一个
  - 用户ID与该用户拥有的进程、文件等关联，以确定访问权限
  - 组标识符（组ID）允许定义和管理一组用户，然后也与每个进程、文件关联
  - 特权升级允许用户更改为具有更多权限的有效ID

## 内核数据结构

- 单向链表
- 双向链表
- 循环链表
- 堆栈
- 队列
- 树
- 哈希表
- 位图

## 分布式系统

- 分布式处理
  - 一种信息处理形式，其中工作由通过通信网络链接的独立计算机执行
  - 需要网络基础设施，例如局域网或广域网
- 分布式系统的优点：
  - 资源共享
  - 加速计算 – 负载共享
  - 高可靠性
  - 紧密通信
- 分布式操作系统的特点：
  - 分配任务
  - 通过网络进行通信，允许不同计算机上的不同处理器交换信息
  - 进程同步
  - 负载共享
  - 有分布式文件系统，文件通过网络共享

## 特殊用途操作系统

- <span id="实时操作系统">实时操作系统</span>
  - 有明确的、固定的时间约束，处理必须在时间约束内完成，
  - 面向对处理器的操作或数据流提出了严格的时间要求的应用程序的计算机系统
  - 硬实时：保证按时完成系统中的关键任务
  - 软实时：关键任务优先于要处理的其他任务，没有时间限制，在需要高级操作系统功能的应用程序（如多媒体、虚拟现实）中非常有用
  - 实时操作系统的重点：
    - 实时任务调度，需要实现抢占式的优先级调度
    - 内存管理
- 嵌入式系统
  - 嵌入式系统是嵌入在设备中的迷你或微型计算机系统，通常用于专用应用程序
  - 嵌入式系统的特点：
    - 面向产品，特定应用程序
    - 嵌入式CPU，也称为DSP，以及其他组件，是控制嵌入式系统的核心
    - 软件存储在固件中
    - CPU速度有限，内存大小有限
    - 严格的临时和稳定性要求
    - 自动循环操作
  - 手持系统，例如手机，是一种嵌入式系统
    - 内存有限
    - 处理器速度较慢
    - 有显示设备
  - 嵌入式操作系统的特点：
    - 代码大小有限制
    - 相对简单的操作系统功能

## 计算环境

- 传统计算
- 移动计算
- 客户机-服务器计算
  - 分布式系统的一种结构
  - 计算服务器系统
  - 文件服务器系统
- 对等计算
  - 分布式系统的另一种结构
  - 不区分客户机与服务器，所有节点都是对等的，取决于节点是请求还是提供服务
  - 通过网络集中查询服务来注册服务或通过一种发现协议广播服务请求
- 虚拟化
  - 允许操作系统在其他操作系统中运行应用程序
  - 当CPU类型不相同时，可以使用转译技术；当计算机语言不能编译为本机代码时，可以使用解释技术
  - 使用虚拟化技术实现主机客户机（虚拟机）
- 云计算
  - 通过网络将计算、存储甚至应用程序作为服务提供
  - 虚拟化技术的延伸，因为它使用虚拟化作为其功能的基础
  - 多种类型：
    - 公有云
    - 私有云
    - 混合云
    - SaaS，软件服务
    - PaaS，平台服务
    - IaaS，基础设施服务
  - 由传统操作系统、VMM和云管理工具组成的云计算环境

![](/assets/posts/os-1-7.jpg)